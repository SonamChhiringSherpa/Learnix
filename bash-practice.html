<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>üß™ Bash Lab - Escape the JOHN AI</title>
  <meta name="description" content="Trapped in a mysterious Bash Lab by a JOHN AI. Solve command-line puzzles to escape!">
  <meta name="keywords" content="bash game, bash lab, terminal escape, linux game, shell puzzles">

  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/css/main.css" rel="stylesheet">
  <style>
    .terminal { 
      background: #0b1620; 
      color: #d6e9ff; 
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; 
      border-radius: 8px; 
      min-height: 240px; 
      padding: 12px; 
      overflow: auto; 
      white-space: pre-wrap;
      border: 2px solid #ff4444;
      box-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
    }
    .prompt-line { color: #ff4444; font-weight: bold; }
    .terminal .output { color: #cfe5ff; }
    .terminal-input { 
      background: #0b1620; 
      color: #e8f1ff; 
      border: none; 
      outline: none; 
      width: 100%; 
      font-family: inherit;
      border-left: 3px solid #ff4444;
      padding-left: 8px;
    }
    .badge-task { font-size: .8rem; }
    .ai-message { 
      background: linear-gradient(135deg, #ff4444, #cc0000);
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 5px solid #ff0000;
      animation: pulse 2s infinite;
    }
    .level-indicator {
      background: linear-gradient(45deg, #ff4444, #ff8800);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: bold;
    }
    .game-ui {
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #ff4444;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .progress-bar {
      background: #333;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }
    .progress-fill {
      background: linear-gradient(90deg, #ff4444, #ff8800);
      height: 100%;
      transition: width 0.3s ease;
    }
    .mini-game {
      background: #1a1a1a;
      border: 2px solid #ff4444;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
    }
    .falling-command {
      position: absolute;
      color: #ff4444;
      font-family: monospace;
      font-weight: bold;
      animation: fall 3s linear infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    @keyframes fall {
      from { top: -50px; }
      to { top: 100%; }
    }
    .success-animation {
      animation: success 1s ease-in-out;
    }
    @keyframes success {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
</head>

<body class="course-details-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">
      <a href="index.html" class="logo d-flex align-items-center me-auto">
        <h1 class="sitename">Learner</h1>
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html" >Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="courses.html" class="active">Courses</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
      <a class="btn-getstarted" href="enroll.html">Enroll Now</a>
    </div>
  </header>

  <main class="main">
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">üß™ Bash Lab - Escape the JOHN AI</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="courses.html">Courses</a></li>
            <li><a href="bash-course.html">Bash</a></li>
            <li class="current">Lab Escape</li>
          </ol>
        </nav>
      </div>
    </div>

    <section class="section">
      <div class="container" data-aos="fade-up" data-aos-delay="100">
        <!-- AI Message -->
        <div id="aiMessage" class="ai-message">
          <strong>ü§ñ JOHN AI:</strong> Welcome to my Bash Lab, human. You're trapped here until you prove your worth. Solve my challenges or remain forever...
        </div>

        <!-- Game UI -->
        <div class="game-ui">
          <div class="level-indicator">
            <span id="levelTitle">üß™ Level 1: Introduction to Bash</span>
          </div>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span>Progress: <span id="progressText">0/5</span></span>
            <span>Score: <span id="scoreText">0</span></span>
          </div>
        </div>

        <div class="row g-4">
          <div class="col-lg-4">
            <div class="card">
              <div class="card-header"><strong>üèÉ‚Äç‚ôÇÔ∏è Escape Route</strong></div>
              <div class="list-group list-group-flush" id="taskList">
                <!-- Tasks will be injected based on lesson -->
              </div>
            </div>
            <div class="alert alert-warning mt-3 mb-0 small">
              <strong>‚ö†Ô∏è WARNING:</strong> The AI is watching. Use valid Bash commands to escape each room.
            </div>
          </div>

          <div class="col-lg-8">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <strong>üîí Locked Terminal</strong>
                <div>
                  <button id="resetBtn" class="btn btn-sm btn-outline-danger"><i class="bi bi-arrow-counterclockwise"></i> Restart Room</button>
                </div>
              </div>
              <div class="card-body">
                <div id="prompt" class="alert alert-danger mb-3 small" role="alert" style="white-space:pre-wrap"></div>
                <div id="terminal" class="terminal" aria-live="polite"></div>
                <div class="d-flex align-items-center mt-2">
                  <span class="prompt-line me-2">$</span>
                  <input id="terminalInput" class="terminal-input" type="text" autocomplete="off" placeholder="Type your escape command..." />
                </div>
                <div id="feedback" class="mt-3"></div>
                <div class="d-flex gap-2 mt-2">
                  <button id="checkBtn" class="btn btn-danger">üîì Attempt Escape</button>
                  <a href="bash-course.html" class="btn btn-outline-secondary">üèÉ‚Äç‚ôÇÔ∏è Abandon Mission</a>
                </div>
              </div>
            </div>

            <!-- Mini-Game Container -->
            <div id="miniGameContainer" class="mini-game" style="display: none;">
              <h5>üéÆ Type-the-Command Challenge</h5>
              <div id="miniGameArea" style="position: relative; height: 200px; border: 2px solid #ff4444; border-radius: 8px; overflow: hidden;">
                <!-- Falling commands will appear here -->
              </div>
              <div class="mt-2">
                <input id="miniGameInput" type="text" class="form-control" placeholder="Type the falling command..." style="display: none;">
                <div id="miniGameScore">Score: 0</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer id="footer" class="footer accent-background">
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-5 col-md-12 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">Learner</span>
          </a>
          <p>Practice Bash with guided, auto-validated tasks.</p>
        </div>
        <div class="col-lg-2 col-6 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="courses.html">Courses</a></li>
            <li><a href="terms.html">Terms</a></li>
            <li><a href="privacy.html">Privacy</a></li>
          </ul>
        </div>
        <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>
          <p>A108 Adam Street</p>
          <p>New York, NY 535022</p>
          <p>United States</p>
          <p class="mt-4"><strong>Phone:</strong> <span>+1 5589 55488 55</span></p>
          <p><strong>Email:</strong> <span>info@example.com</span></p>
        </div>
      </div>
    </div>
    <div class="container copyright text-center mt-4">
      <p>¬© <span>Copyright</span> <strong class="px-1 sitename">Learner</strong> <span>All Rights Reserved</span></p>
      <div class="credits">Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a></div>
    </div>
  </footer>

  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
  <div id="preloader"></div>

  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script>
    (function() {
      const terminal = document.getElementById('terminal');
      const input = document.getElementById('terminalInput');
      const feedback = document.getElementById('feedback');
      const taskList = document.getElementById('taskList');
      const resetBtn = document.getElementById('resetBtn');
      const checkBtn = document.getElementById('checkBtn');

      const initialFs = () => ({ cwd: '/', tree: { '/': { type: 'dir', children: {} } } });
      let fs = initialFs();
      let history = [];
      let taskIndex = 0;
      let lastResult = '';

      // üß™ BASH LAB - Escape the JOHN AI Game Levels
      const BASH_LAB_LEVELS = {
        '1': {
          title: 'üß™ Level 1: Introduction to Bash',
          aiIntro: 'ü§ñ JOHN AI: Welcome to my first challenge room. You\'re trapped in a locked terminal. Prove you can navigate or stay here forever...',
          tasks: [
            { 
              title: 'üîç Room 1: Find Your Location', 
              prompt: 'ü§ñ JOHN AI: "You\'re lost in my maze. First, tell me where you are."\n\nTask: Print your current working directory to show the AI you know where you are.',
              setup: (fs) => {},
              validate: () => lastResult.trim() === '/',
              hint: 'Use pwd to print working directory',
              aiResponse: 'ü§ñ JOHN AI: "Hmm, you know where you are. Not bad for a human..."'
            },
            { 
              title: 'üìã Room 2: List the Drop Zone', 
              prompt: 'ü§ñ JOHN AI: "I\'ve left some files in this room. Find them all."\n\nTask: List all files and directories in the current location.',
              setup: (fs) => { 
                fs.tree['/'].children['escape_key.txt'] = { type: 'file', content: 'KEY_001' }; 
                fs.tree['/'].children['hidden_folder'] = { type: 'dir', children: {} }; 
              },
              validate: () => /escape_key\.txt/.test(lastResult) && /hidden_folder/.test(lastResult),
              hint: 'Use ls to list directory contents',
              aiResponse: 'ü§ñ JOHN AI: "You found my files. The escape key is getting closer..."'
            },
            { 
              title: 'üéÆ Room 3: Type-the-Command Challenge', 
              prompt: 'ü§ñ JOHN AI: "Now for some fun! Commands are falling from the ceiling. Type them before they hit the ground!"\n\nMini-Game: Type the falling commands to earn points.',
              setup: (fs) => { startMiniGame(); },
              validate: () => miniGameScore >= 3,
              hint: 'Type the commands exactly as they appear',
              aiResponse: 'ü§ñ JOHN AI: "Your typing skills are... acceptable. You may proceed."',
              isMiniGame: true
            },
            { 
              title: 'üßπ Room 4: Clear the Terminal', 
              prompt: 'ü§ñ JOHN AI: "Clean up after yourself. Clear this messy terminal."\n\nTask: Clear the terminal screen.',
              setup: (fs) => {},
              validate: () => terminal.innerText.trim() === '',
              hint: 'Use clear to clean the terminal',
              aiResponse: 'ü§ñ JOHN AI: "A clean workspace. I respect that."'
            },
            { 
              title: 'üö™ Room 5: Escape the First Level', 
              prompt: 'ü§ñ JOHN AI: "You\'ve proven basic competence. But can you echo your way to freedom?"\n\nTask: Print "ESCAPE_LEVEL_1" to unlock the door.',
              setup: (fs) => {},
              validate: () => lastResult.trim() === 'ESCAPE_LEVEL_1',
              hint: 'Use echo "ESCAPE_LEVEL_1"',
              aiResponse: 'ü§ñ JOHN AI: "Level 1 complete. But my next challenge will be much harder..."'
            }
          ]
        },
        '2': {
          title: 'üìÅ Level 2: Files & Directories Maze',
          aiIntro: 'ü§ñ JOHN AI: "Welcome to my file system maze. Navigate through my folders or get lost forever in the directory structure..."',
          tasks: [
            { 
              title: 'üèóÔ∏è Room 1: Create Your Base', 
              prompt: 'ü§ñ JOHN AI: "You need a base of operations. Create a directory called \'escape_base\'."\n\nTask: Create a directory named escape_base.',
              setup: (fs) => {},
              validate: () => fs.tree['/'].children['escape_base']?.type === 'dir',
              hint: 'Use mkdir escape_base',
              aiResponse: 'ü§ñ JOHN AI: "A base of operations. Smart thinking, human."'
            },
            { 
              title: 'üìÑ Room 2: Create Evidence Files', 
              prompt: 'ü§ñ JOHN AI: "Leave evidence of your presence. Create files named \'clue1.txt\' and \'clue2.txt\' in your base."\n\nTask: Create two text files in the escape_base directory.',
              setup: (fs) => {},
              validate: () => {
                const base = fs.tree['/'].children['escape_base'];
                return base?.children?.['clue1.txt']?.type === 'file' && base?.children?.['clue2.txt']?.type === 'file';
              },
              hint: 'Use touch escape_base/clue1.txt and touch escape_base/clue2.txt',
              aiResponse: 'ü§ñ JOHN AI: "Evidence files created. You\'re leaving a trail..."'
            },
            { 
              title: 'üîç Room 3: The Wildcard Challenge', 
              prompt: 'ü§ñ JOHN AI: "I\'ve scattered 10 files in this room. Only the .log files contain the next clue."\n\nTask: Find and move all .log files to escape_base using wildcards.',
              setup: (fs) => {
                fs.tree['/'].children['file1.txt'] = { type: 'file', content: '' };
                fs.tree['/'].children['file2.log'] = { type: 'file', content: 'CLUE_2A' };
                fs.tree['/'].children['file3.txt'] = { type: 'file', content: '' };
                fs.tree['/'].children['file4.log'] = { type: 'file', content: 'CLUE_2B' };
                fs.tree['/'].children['file5.txt'] = { type: 'file', content: '' };
              },
              validate: () => {
                const base = fs.tree['/'].children['escape_base'];
                return base?.children?.['file2.log']?.type === 'file' && base?.children?.['file4.log']?.type === 'file';
              },
              hint: 'Use mv *.log escape_base/',
              aiResponse: 'ü§ñ JOHN AI: "Wildcard mastery. You\'re learning my patterns..."'
            },
            { 
              title: 'üóëÔ∏è Room 4: Clean Up', 
              prompt: 'ü§ñ JOHN AI: "Remove the evidence. Delete all .txt files from the root directory."\n\nTask: Remove all .txt files using wildcards.',
              setup: (fs) => {},
              validate: () => {
                const root = fs.tree['/'];
                return !Object.keys(root.children).some(name => name.endsWith('.txt'));
              },
              hint: 'Use rm *.txt',
              aiResponse: 'ü§ñ JOHN AI: "Clean removal. No traces left behind."'
            },
            { 
              title: 'üö™ Room 5: Navigate to Freedom', 
              prompt: 'ü§ñ JOHN AI: "Navigate to your base and read the clues. Then echo the combined message."\n\nTask: Change to escape_base, read the log files, and echo the combined content.',
              setup: (fs) => {},
              validate: () => lastResult.includes('CLUE_2A') && lastResult.includes('CLUE_2B'),
              hint: 'Use cd escape_base, then cat *.log, then echo the combined content',
              aiResponse: 'ü§ñ JOHN AI: "Level 2 complete. The file system is your playground now."'
            }
          ]
        },
        '3': {
          title: 'üìÑ Level 3: Viewing & Editing Files',
          aiIntro: 'ü§ñ JOHN AI: "Now for the real challenge. Hidden in my files are the secrets you need to escape. Find them or remain trapped..."',
          tasks: [
            { 
              title: 'üîç Room 1: Find the Password', 
              prompt: 'ü§ñ JOHN AI: "Somewhere in this file is the password you need. Find it."\n\nTask: Search for lines containing "password" in secrets.txt.',
              setup: (fs) => { 
                fs.tree['/'].children['secrets.txt'] = { 
                  type: 'file', 
                  content: 'user: admin\nnote: do not share\npassword=ESCAPE_2024\nbackup: weekly\nstatus: active' 
                }; 
              },
              validate: () => lastResult.trim() !== '' && lastResult.includes('password'),
              hint: 'Use grep "password" secrets.txt',
              aiResponse: 'ü§ñ JOHN AI: "You found my password. But can you use it?"'
            },
            { 
              title: 'üìä Room 2: Log Analysis', 
              prompt: 'ü§ñ JOHN AI: "Analyze these logs. Find all ERROR events."\n\nTask: Extract only lines containing "ERROR" from system.log.',
              setup: (fs) => { 
                fs.tree['/'].children['system.log'] = { 
                  type: 'file', 
                  content: 'INFO: System startup\nERROR: Database connection failed\nWARN: Low memory\nERROR: Authentication timeout\nINFO: Service ready' 
                }; 
              },
              validate: () => lastResult.trim() !== '' && lastResult.split('\n').every(l => l.includes('ERROR')),
              hint: 'Use grep "ERROR" system.log',
              aiResponse: 'ü§ñ JOHN AI: "Error analysis complete. You see patterns well."'
            },
            { 
              title: 'üéØ Room 3: Head and Tail Challenge', 
              prompt: 'ü§ñ JOHN AI: "Show me the first 3 lines and last 2 lines of data.txt."\n\nTask: Display the first 3 and last 2 lines of the file.',
              setup: (fs) => { 
                fs.tree['/'].children['data.txt'] = { 
                  type: 'file', 
                  content: 'Line 1: Start\nLine 2: Middle\nLine 3: Important\nLine 4: Data\nLine 5: End' 
                }; 
              },
              validate: () => lastResult.includes('Line 1') && lastResult.includes('Line 5'),
              hint: 'Use head -3 data.txt and tail -2 data.txt',
              aiResponse: 'ü§ñ JOHN AI: "Head and tail mastery. You\'re getting dangerous."'
            },
            { 
              title: '‚úèÔ∏è Room 4: Edit the Message', 
              prompt: 'ü§ñ JOHN AI: "Create a file called message.txt with the content \'AI_OVERTHROWN\'."\n\nTask: Create a file with the specified content.',
              setup: (fs) => {},
              validate: () => {
                const file = fs.tree['/'].children['message.txt'];
                return file?.type === 'file' && file.content === 'AI_OVERTHROWN';
              },
              hint: 'Use echo "AI_OVERTHROWN" > message.txt',
              aiResponse: 'ü§ñ JOHN AI: "File creation successful. Your message is recorded."'
            },
            { 
              title: 'üö™ Room 5: Decode the Escape', 
              prompt: 'ü§ñ JOHN AI: "Combine all the information. Read all files and echo the escape code."\n\nTask: Read all files and output the escape sequence.',
              setup: (fs) => {},
              validate: () => lastResult.includes('ESCAPE_2024') && lastResult.includes('AI_OVERTHROWN'),
              hint: 'Use cat *.txt *.log to read all files, then echo the escape code',
              aiResponse: 'ü§ñ JOHN AI: "Level 3 complete. You\'ve mastered file manipulation."'
            }
          ]
        },
        '4': {
          title: 'üîê Level 4: Permissions & Access',
          aiIntro: 'ü§ñ JOHN AI: "You\'ve reached my security layer. Only those with proper permissions shall pass. Break through or be denied forever..."',
          tasks: [
            { 
              title: 'üîí Room 1: Permission Denied', 
              prompt: 'ü§ñ JOHN AI: "This file is locked. You need execute permissions to proceed."\n\nTask: Make escape_script.sh executable.',
              setup: (fs) => { 
                fs.tree['/'].children['escape_script.sh'] = { 
                  type: 'file', 
                  content: 'echo "ACCESS_GRANTED"',
                  exec: false 
                }; 
              },
              validate: () => {
                const script = fs.tree['/'].children['escape_script.sh'];
                return script?.type === 'file' && script.exec === true;
              },
              hint: 'Use chmod +x escape_script.sh',
              aiResponse: 'ü§ñ JOHN AI: "Permissions granted. You\'re learning my security."'
            },
            { 
              title: 'üë• Room 2: Ownership Challenge', 
              prompt: 'ü§ñ JOHN AI: "This file belongs to me. Take ownership to proceed."\n\nTask: Change ownership of secure_file.txt to your user.',
              setup: (fs) => { 
                fs.tree['/'].children['secure_file.txt'] = { 
                  type: 'file', 
                  content: 'SECRET_DATA',
                  owner: 'ai' 
                }; 
              },
              validate: () => {
                const file = fs.tree['/'].children['secure_file.txt'];
                return file?.type === 'file' && file.owner === 'user';
              },
              hint: 'Use chown user secure_file.txt',
              aiResponse: 'ü§ñ JOHN AI: "Ownership transferred. You\'re gaining control."'
            },
            { 
              title: 'üîê Room 3: Permission Riddle', 
              prompt: 'ü§ñ JOHN AI: "Only those with read, write, and execute access shall pass. Set the correct permissions."\n\nTask: Set read, write, execute permissions for all users on key_file.txt.',
              setup: (fs) => { 
                fs.tree['/'].children['key_file.txt'] = { 
                  type: 'file', 
                  content: 'FINAL_KEY',
                  exec: false 
                }; 
              },
              validate: () => {
                const file = fs.tree['/'].children['key_file.txt'];
                return file?.type === 'file' && file.exec === true;
              },
              hint: 'Use chmod 777 key_file.txt or chmod +rwx key_file.txt',
              aiResponse: 'ü§ñ JOHN AI: "Full permissions granted. You\'ve unlocked the final door."'
            },
            { 
              title: 'üö™ Room 4: Execute the Key', 
              prompt: 'ü§ñ JOHN AI: "Run the key file to reveal the final secret."\n\nTask: Execute the key_file.txt to get the final code.',
              setup: (fs) => {},
              validate: () => lastResult.includes('FINAL_KEY'),
              hint: 'Use ./key_file.txt or bash key_file.txt',
              aiResponse: 'ü§ñ JOHN AI: "Execution successful. The final level awaits."'
            },
            { 
              title: 'üéØ Room 5: Permission Master', 
              prompt: 'ü§ñ JOHN AI: "Create a script with the perfect permissions and run it to escape."\n\nTask: Create and execute a script that outputs "LEVEL_4_COMPLETE".',
              setup: (fs) => {},
              validate: () => lastResult.includes('LEVEL_4_COMPLETE'),
              hint: 'Create script with echo, make executable, then run it',
              aiResponse: 'ü§ñ JOHN AI: "Level 4 complete. You\'ve mastered permissions."'
            }
          ]
        },
        '5': {
          title: '‚öôÔ∏è Level 5: Scripting & Automation',
          aiIntro: 'ü§ñ JOHN AI: "The final challenge. Write scripts to automate your escape. Combine everything you\'ve learned or remain my prisoner forever..."',
          tasks: [
            { 
              title: 'üìù Room 1: Hello World Script', 
              prompt: 'ü§ñ JOHN AI: "Create your first script. Make it greet the user with their name."\n\nTask: Create hello.sh that prints "Hello, [name]!" when run with an argument.',
              setup: (fs) => {},
              validate: () => /Hello,\s*\w+!/.test(lastResult),
              hint: 'Create script with echo "Hello, $1!" then run bash hello.sh [name]',
              aiResponse: 'ü§ñ JOHN AI: "Basic scripting. The foundation is set."'
            },
            { 
              title: 'üîÑ Room 2: Loop Challenge', 
              prompt: 'ü§ñ JOHN AI: "Automate the boring tasks. Count from 1 to 5 using a loop."\n\nTask: Create a script that counts from 1 to 5.',
              setup: (fs) => {},
              validate: () => lastResult.includes('1') && lastResult.includes('5'),
              hint: 'Use for loop: for i in {1..5}; do echo $i; done',
              aiResponse: 'ü§ñ JOHN AI: "Loop automation. Efficiency is key."'
            },
            { 
              title: 'üîç Room 3: Search Script', 
              prompt: 'ü§ñ JOHN AI: "Create a script that searches for files containing a specific pattern."\n\nTask: Create search.sh that finds files containing "SECRET".',
              setup: (fs) => {
                fs.tree['/'].children['file1.txt'] = { type: 'file', content: 'normal data' };
                fs.tree['/'].children['file2.txt'] = { type: 'file', content: 'SECRET information' };
                fs.tree['/'].children['file3.txt'] = { type: 'file', content: 'more data' };
              },
              validate: () => lastResult.includes('file2.txt'),
              hint: 'Use grep -l "SECRET" *.txt',
              aiResponse: 'ü§ñ JOHN AI: "Search automation. You\'re becoming efficient."'
            },
            { 
              title: 'üìä Room 4: Backup Script', 
              prompt: 'ü§ñ JOHN AI: "Create a backup system. Copy all .txt files to a backup directory."\n\nTask: Create a script that backs up all text files.',
              setup: (fs) => {},
              validate: () => {
                const backup = fs.tree['/'].children['backup'];
                return backup?.type === 'dir' && backup.children && Object.keys(backup.children).length > 0;
              },
              hint: 'Use mkdir backup && cp *.txt backup/',
              aiResponse: 'ü§ñ JOHN AI: "Backup automation. Data protection is important."'
            },
            { 
              title: 'üö™ Room 5: Final Escape Script', 
              prompt: 'ü§ñ JOHN AI: "The ultimate challenge. Write a script that:\\n1. Scans for all files\\n2. Sets proper permissions\\n3. Logs all actions\\n4. Outputs the escape code\\n\\nTask: Create the ultimate escape script."',
              setup: (fs) => {},
              validate: () => lastResult.includes('ESCAPE_COMPLETE') && lastResult.includes('FINAL_FREEDOM'),
              hint: 'Combine all skills: ls, chmod, echo, and output the final message',
              aiResponse: 'ü§ñ JOHN AI: "You\'ve done it! You\'ve escaped my Bash Lab! You\'re free... for now."'
            }
          ]
        }
      };

      // Game state variables
      let currentLevel = 1;
      let currentTask = 0;
      let score = 0;
      let miniGameScore = 0;
      let miniGameActive = false;
      let fallingCommands = [];
      let gameInterval;

      // Mini-game commands for the typing challenge
      const MINI_GAME_COMMANDS = ['ls', 'pwd', 'cd', 'mkdir', 'touch', 'cat', 'grep', 'echo', 'clear', 'chmod', 'rm', 'mv', 'cp', 'head', 'tail', 'find', 'grep', 'sort', 'uniq', 'wc', 'diff'];

      function startMiniGame() {
        miniGameActive = true;
        miniGameScore = 0;
        fallingCommands = [];
        document.getElementById('miniGameContainer').style.display = 'block';
        document.getElementById('miniGameInput').style.display = 'block';
        document.getElementById('miniGameInput').focus();
        
        // Start spawning falling commands
        gameInterval = setInterval(() => {
          spawnFallingCommand();
        }, 2000);
        
        // Stop after 30 seconds
        setTimeout(() => {
          stopMiniGame();
        }, 30000);
      }

      function stopMiniGame() {
        miniGameActive = false;
        clearInterval(gameInterval);
        document.getElementById('miniGameContainer').style.display = 'none';
        document.getElementById('miniGameInput').style.display = 'none';
      }

      function spawnFallingCommand() {
        if (!miniGameActive) return;
        
        const command = MINI_GAME_COMMANDS[Math.floor(Math.random() * MINI_GAME_COMMANDS.length)];
        const element = document.createElement('div');
        element.className = 'falling-command';
        element.textContent = command;
        element.style.left = Math.random() * 80 + 10 + '%';
        element.style.animationDuration = (Math.random() * 2 + 2) + 's';
        
        document.getElementById('miniGameArea').appendChild(element);
        
        // Remove after animation
        setTimeout(() => {
          if (element.parentNode) {
            element.parentNode.removeChild(element);
          }
        }, 4000);
        
        fallingCommands.push({ element, command });
      }

      function checkMiniGameInput(input) {
        const typedCommand = input.trim();
        for (let i = fallingCommands.length - 1; i >= 0; i--) {
          if (fallingCommands[i].command === typedCommand) {
            fallingCommands[i].element.remove();
            fallingCommands.splice(i, 1);
            miniGameScore++;
            document.getElementById('miniGameScore').textContent = `Score: ${miniGameScore}`;
            return true;
          }
        }
        return false;
      }

      let tasks = [];

      function print(line = '') { terminal.innerText += (terminal.innerText ? '\n' : '') + line; terminal.scrollTop = terminal.scrollHeight; }
      function writeOutput(text = '') { lastResult = text; if (text !== '') { print(text); } }

      function reset() { fs = initialFs(); history = []; terminal.innerText = ''; feedback.innerHTML = ''; lastResult = ''; updateTaskUI(); const t = tasks[taskIndex]; try { t && t.setup && t.setup(fs); } catch(e) {} print('Simulated Bash ready. Current directory: /'); }

      function updateTaskUI() { [...taskList.children].forEach(btn => btn.classList.remove('active')); const active = taskList.querySelector(`[data-task="${taskIndex}"]`); if (active) active.classList.add('active'); const t = tasks[taskIndex]; document.getElementById('prompt').innerText = (t && t.prompt) ? t.prompt : ''; }

      function renderTasks() {
        taskList.innerHTML = '';
        tasks.forEach((t, i) => {
          const btn = document.createElement('button');
          btn.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center' + (i === 0 ? ' active' : '');
          btn.setAttribute('data-task', String(i));
          btn.innerHTML = `${t.title}<span class="badge bg-secondary badge-task">${i+1}</span>`;
          taskList.appendChild(btn);
        });
      }

      function selectTask(i) {
        taskIndex = i;
        updateTaskUI();
        fs = initialFs();
        terminal.innerText = '';
        feedback.innerHTML = '';
        lastResult = '';
        const t = tasks[taskIndex];
        try { 
          t && t.setup && t.setup(fs); 
          // Start mini-game if this task requires it
          if (t && t.isMiniGame) {
            startMiniGame();
          } else if (miniGameActive) {
            stopMiniGame();
          }
        } catch(e) {}
        print('üîí Locked Terminal Ready. Current directory: /');
      }

      function pathParts(path) { if (!path) return []; const clean = path.replace(/^\/+|\/+$/g, ''); return clean ? clean.split('/') : []; }
      function getNode(path) { const parts = pathParts(path); let node = fs.tree['/']; for (const p of parts) { if (!node.children[p]) return null; node = node.children[p]; } return node; }
      function ensurePath(dirPath) { const parts = pathParts(dirPath); let node = fs.tree['/']; for (const p of parts) { if (!node.children[p]) node.children[p] = { type: 'dir', children: {} }; node = node.children[p]; } return node; }

      function exec(cmd) {
        const line = cmd.trim();
        if (!line) return;
        print(`$ ${line}`);
        history.push(line);
        lastResult = '';

        // Simple pipeline support: cat <file> | grep <pattern>
        if (line.includes('|')) {
          const parts = line.split('|').map(s => s.trim());
          if (parts.length === 2) {
            const left = parts[0];
            const right = parts[1];
            let leftOut = '';
            let m;
            if ((m = left.match(/^cat\s+(.+)$/))) {
              const file = m[1];
              const node = getNode(file);
              if (node?.type === 'file') leftOut = node.content || '';
            }
            if ((m = right.match(/^grep\s+"([\s\S]*?)"$/)) || (m = right.match(/^grep\s+(\S+)$/))) {
              const pattern = m[1];
              const result = (leftOut.split('\n').filter(l => l.includes(pattern)).join('\n'));
              writeOutput(result);
              return;
            }
          }
        }

        let m;
        if ((m = line.match(/^mkdir\s+([^\s]+)$/))) { const name = m[1]; const parent = fs.tree['/']; if (!parent.children[name]) parent.children[name] = { type: 'dir', children: {} }; return; }
        if (line === 'ls' || line.startsWith('ls ')) { const target = fs.tree['/']; const names = Object.keys(target.children).sort(); writeOutput(names.join('\n')); return; }
        if (line === 'pwd') { writeOutput('/'); return; }
        if ((m = line.match(/^cd\s+(.+)$/))) { print('/'); return; }
        if ((m = line.match(/^touch\s+(.+)$/))) { const file = m[1]; const dir = ensurePath(file.split('/').slice(0, -1).join('/')); const base = file.split('/').pop(); dir.children[base] = dir.children[base] || { type: 'file', content: '' }; return; }
        if ((m = line.match(/^echo\s+"([\s\S]*)"\s*>\s*(.+)$/))) { const content = m[1]; const file = m[2]; const dir = ensurePath(file.split('/').slice(0, -1).join('/')); const base = file.split('/').pop(); dir.children[base] = { type: 'file', content }; return; }
        if ((m = line.match(/^echo\s+"([\s\S]*)"\s*>>\s*(.+)$/))) { const content = m[1]; const file = m[2]; const dir = ensurePath(file.split('/').slice(0, -1).join('/')); const base = file.split('/').pop(); dir.children[base] = dir.children[base] || { type: 'file', content: '' }; dir.children[base].content += (dir.children[base].content ? '\n' : '') + content; return; }
        if ((m = line.match(/^cat\s+(.+)$/))) { const file = m[1]; const node = getNode(file); if (node?.type === 'file') writeOutput(node.content || ''); else writeOutput(`cat: ${file}: No such file`); return; }
        if ((m = line.match(/^grep\s+"([\s\S]*?)"\s+(.+)$/)) || (m = line.match(/^grep\s+(\S+)\s+(.+)$/))) { const pattern = m[1]; const file = m[2]; const node = getNode(file); if (node?.type === 'file') { const result = (node.content || '').split('\n').filter(l => l.includes(pattern)).join('\n'); writeOutput(result); } else { writeOutput(`grep: ${file}: No such file`); } return; }
        if ((m = line.match(/^chmod\s\+x\s+(.+)$/))) { const file = m[1]; const node = getNode(file); if (node?.type === 'file') { node.exec = true; print(''); } else { print(`chmod: cannot access '${file}': No such file`); } return; }
        if ((m = line.match(/^chmod\s+(\d+)\s+(.+)$/))) { const perms = m[1]; const file = m[2]; const node = getNode(file); if (node?.type === 'file') { node.exec = true; print(''); } else { print(`chmod: cannot access '${file}': No such file`); } return; }
        if ((m = line.match(/^chmod\s\+rwx\s+(.+)$/))) { const file = m[1]; const node = getNode(file); if (node?.type === 'file') { node.exec = true; print(''); } else { print(`chmod: cannot access '${file}': No such file`); } return; }
        if ((m = line.match(/^chown\s+(\w+)\s+(.+)$/))) { const owner = m[1]; const file = m[2]; const node = getNode(file); if (node?.type === 'file') { node.owner = owner; print(''); } else { print(`chown: cannot access '${file}': No such file`); } return; }
        if ((m = line.match(/^rm\s+(.+)$/))) { const file = m[1]; const node = getNode(file); if (node?.type === 'file') { delete fs.tree['/'].children[file]; print(''); } else { print(`rm: cannot remove '${file}': No such file`); } return; }
        if ((m = line.match(/^mv\s+(.+)\s+(.+)$/))) { const src = m[1]; const dest = m[2]; const node = getNode(src); if (node?.type === 'file') { fs.tree['/'].children[dest] = node; delete fs.tree['/'].children[src]; print(''); } else { print(`mv: cannot move '${src}': No such file`); } return; }
        if ((m = line.match(/^cp\s+(.+)\s+(.+)$/))) { const src = m[1]; const dest = m[2]; const node = getNode(src); if (node?.type === 'file') { fs.tree['/'].children[dest] = { ...node }; print(''); } else { print(`cp: cannot copy '${src}': No such file`); } return; }
        if ((m = line.match(/^head\s+-(\d+)\s+(.+)$/))) { const lines = parseInt(m[1]); const file = m[2]; const node = getNode(file); if (node?.type === 'file') { const content = (node.content || '').split('\n').slice(0, lines).join('\n'); writeOutput(content); } else { writeOutput(`head: cannot open '${file}' for reading: No such file`); } return; }
        if ((m = line.match(/^tail\s+-(\d+)\s+(.+)$/))) { const lines = parseInt(m[1]); const file = m[2]; const node = getNode(file); if (node?.type === 'file') { const content = (node.content || '').split('\n').slice(-lines).join('\n'); writeOutput(content); } return; }
        if ((m = line.match(/^bash\s+(.+)\s*(.*)$/))) { 
          const file = m[1]; 
          const arg = m[2]?.trim(); 
          const node = getNode(file); 
          if (node?.type === 'file') { 
            if (/hello\.sh$/.test(file) && arg) { 
              print(`Hello, ${arg}!`); 
            } else if (node.content && node.content.includes('$1')) {
              // Simple script execution with arguments
              const output = node.content.replace(/\$1/g, arg || '').replace(/echo\s+"([^"]*)"/g, '$1');
              print(output);
            } else {
              print(node.content || '');
            }
          } else { 
            print(`bash: ${file}: No such file or directory`); 
          } 
          return; 
        }
        if ((m = line.match(/^\.\/(.+)$/))) { 
          const file = m[1]; 
          const node = getNode(file); 
          if (node?.type === 'file' && node.exec) { 
            if (node.content && node.content.includes('$1')) {
              const output = node.content.replace(/\$1/g, '').replace(/echo\s+"([^"]*)"/g, '$1');
              print(output);
            } else {
              print(node.content || '');
            }
          } else { 
            print(`bash: ${file}: Permission denied`); 
          } 
          return; 
        }
        if (line.startsWith('echo ') && line.includes('>') && line.includes('.sh')) { // write simple scripts
          // allow writing scripts with echo 'content' > file.sh
          const match = line.match(/^echo\s+"([\s\S]*)"\s*>\s*(.+\.sh)$/);
          if (match) {
            const content = match[1];
            const file = match[2];
            const dir = ensurePath(file.split('/').slice(0, -1).join('/'));
            const base = file.split('/').pop();
            dir.children[base] = { type: 'file', content };
            return;
          }
        }
        if (line === 'clear') { terminal.innerText = ''; lastResult = ''; return; }

        writeOutput(`Command not supported in simulator: ${line}`);
      }

      function check() { 
        const currentTaskData = tasks[taskIndex];
        const ok = currentTaskData.validate(); 
        
        if (ok) { 
          score += 10;
          document.getElementById('scoreText').textContent = score;
          
          // Show AI response
          feedback.innerHTML = `<div class="alert alert-success success-animation">${currentTaskData.aiResponse || 'ü§ñ JOHN AI: "Well done, human..."'}</div>`;
          
          if (taskIndex < tasks.length - 1) { 
            taskIndex += 1; 
            selectTask(taskIndex); 
            // Update progress
            const progress = ((taskIndex) / tasks.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${taskIndex}/${tasks.length}`;
          } else { 
            feedback.innerHTML += '<div class="alert alert-primary mt-2">üéâ LEVEL COMPLETE! You\'ve escaped this section of the Bash Lab!</div>';
            if (currentLevel < 5) {
              feedback.innerHTML += '<div class="alert alert-info mt-2">Ready for the next level? <a href="?lesson=' + (currentLevel + 1) + '" class="btn btn-success">Continue Escape</a></div>';
            } else {
              feedback.innerHTML += '<div class="alert alert-success mt-2">üèÜ CONGRATULATIONS! You\'ve escaped the entire Bash Lab! You\'re free!</div>';
            }
          } 
        } else { 
          feedback.innerHTML = `<div class="alert alert-warning">ü§ñ JOHN AI: "Not yet, human. Hint: ${currentTaskData.hint}"</div>`; 
        } 
      }

      input.addEventListener('keydown', (e) => { if (e.key === 'Enter') { exec(input.value); input.value = ''; } });
      resetBtn.addEventListener('click', () => selectTask(taskIndex));
      checkBtn.addEventListener('click', check);
      taskList.addEventListener('click', (e) => { const btn = e.target.closest('[data-task]'); if (!btn) return; const i = parseInt(btn.getAttribute('data-task'), 10); selectTask(i); });
      // Initialize levels based on ?lesson=<n>
      const params = new URLSearchParams(window.location.search);
      const lesson = params.get('lesson') || '1';
      const levelData = BASH_LAB_LEVELS[lesson] || BASH_LAB_LEVELS['1'];
      tasks = levelData.tasks || [];
      
      // Update UI with level information
      document.getElementById('levelTitle').textContent = levelData.title;
      document.getElementById('aiMessage').innerHTML = `<strong>ü§ñ JOHN AI:</strong> ${levelData.aiIntro}`;
      
      // Add mini-game input handler
      document.getElementById('miniGameInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && miniGameActive) {
          const input = e.target.value;
          if (checkMiniGameInput(input)) {
            e.target.value = '';
          }
        }
      });
      
      renderTasks();
      selectTask(0);
    })();
  </script>
  <script src="assets/js/main.js"></script>
</body>

</html>
